
<!-- vim: set ts=3 ft=javascript: -->
<script src="/javascripts/handlebars-v2.0.0.js"></script>
<script src="/javascripts/aton.min.js"></script>

<style>

summary {
	/* prevent a box from showing around summary text */
	outline:none;
}

.example-button {
	/* the button used to expand/collapse example code sections */
	background: #bb2200;
	box-shadow: 2px 2px 3px #777777;
	cursor: pointer;
	cursor: hand;
	font-size: 80%;
	color: white;
	border-radius: 3px;
	padding-right: 5px;
	margin-top: 0;
	padding-left: 5px;
	float: right;
}

</style>


{% raw %}

<!-- Handlebars templates and helper functions ------------------- -->

<script id="method-doc" type="text/x-handlebars-template">
	{{#if LONGDESC}}
		<a name="{{METHOD}}"> </a>
		<details>
			<summary>
			<span style="font-weight:900">{{METHOD}}</span> &mdash;
			{{{SHORTDESC}}}
			</summary>
			<div style="margin-left:40px;">
				{{{LONGDESC}}}
				{{{showExamples EXAMPLE}}}
			</div>
		</details>
	{{else}}
		<a name="{{METHOD}}"> </a>
		<span style="padding-left:19px; font-weight:900">{{METHOD}}</span> &mdash;
			{{{SHORTDESC}}}
	{{/if}}
</script>



<script id="method-example" type="text/x-handlebars-template">
   <summary>{{{DESCRIPTION}}}</summary>
	<div class="highlight">
	<pre style="margin-left:50px; padding:0; padding-left:10px;">
		<code class="language-javascript" data-lang="javascript">
{{BRIEFCODE}}</code>
	</pre>
	</div>
{{#if BRIEFOUTPUT}}
	Example output:
	<div class="highlight">
	<pre style="margin-left:50px; padding:0; padding-top:12px; padding-left:10px;">
{{BRIEFOUTPUT}}
	</pre>
	</div>
{{/if}}
</script>



<script id="method-example-single" type="text/x-handlebars-template">
	<div class="highlight">
	<pre style="margin-left:50px; padding:0; padding-left:10px;">
		<code class="language-javascript" data-lang="javascript">
{{BRIEFCODE}}</code>
	</pre>
	</div>
{{#if BRIEFOUTPUT}}
	Example output:
	<div class="highlight">
	<pre style="margin-left:50px; padding:0; padding-top:12px; padding-left:10px;">
{{BRIEFOUTPUT}}
	</pre>
	</div>
{{/if}}
</script>



<script>
//
// Handlebars helper functions
//

Handlebars.registerHelper('showExamples', function (entry) {
	if (typeof entry === 'undefined') {
		return 'empty';
	}

	var source = document.getElementById("method-example").textContent;
	var template = Handlebars.compile(source);
	var sourcesingle = document.getElementById("method-example-single")
								.textContent;
	var templatesingle = Handlebars.compile(sourcesingle);

	var output = '';
	if (entry instanceof Array) {
		output += '<br><span style="font-weight:700">Examples</span>';
		output += '<span';
		output += ' class="example-button"';
		output += ' onclick="expandAllExamples(this);">'
		output += 'Expand all';
		output += '</span>\n';
		output += "<ol>\n";
		for (var i=0; i<entry.length; i++) {
			output += "<li>\n";
			output += "<details>\n";
			output += template(entry[i]);
			output += "</details>\n";
			output += "</li>\n";
		}
		output += "</ol>\n";
	} else {
	   output = '<details>';
		output += '<summary>';
		output += '<span style="font-weight:700">Example:</span> ';
		output += entry.DESCRIPTION;
		output += '</summary>';
		output += templatesingle(entry);
	   output += '</details>';
	}

	return output;
});

</script>

<script>

function insertDocumentation(target, template) {
	var name    = target.id;
	var file    = '/doc/methods/' + name + '.aton';
	var request = new XMLHttpRequest();
	request.open('GET', file);
	request.addEventListener('load', function () {
		var atondata = this.responseText;
		var aton = new ATON;
		aton.setOnlyChildRoot();
		var docobj = aton.parse(atondata);
		var dochtml = template(docobj);
		target.innerHTML = dochtml;
	});
	request.addEventListener('error', function () {
		console.error(this.statusText);
	});
	request.send();
};


function expandAllExamples(element) {
	text = element.innerHTML;
	var detailslist = element.parentNode.querySelectorAll('li > details');
	var i;
	if (text.match(/Collapse all/)) {
		for(i=0; i<detailslist.length; i++) {
			detailslist[i].removeAttribute('open');
		}
		element.textContent = "Expand all";
	} else {
		// expand all examples
		for(i=0; i<detailslist.length; i++) {
			detailslist[i].setAttribute('open', true);
		}
		element.textContent = "Collapse all";
	}
	console.log("GOT HERE in expandAllExamples");
}

</script>
{% endraw %}



<script src="/javascripts/handlebars-v2.0.0.js"></script>
<script src="/javascripts/aton.min.js"></script>

<style>
/* vim: set ts=3 ft=javascript: */

summary {
	/* prevent a box from showing around summary text */
	outline:none;
}

.example-output {
	padding-left:5px; 
	margin-right:-20px !important;
	background: #888888; /* Old browsers */
	background: -moz-linear-gradient(left,  #888888 0%, #888888 3%, #3a3c42 91%); /* FF3.6+ */
	background: -webkit-gradient(linear, left top, right top, color-stop(0%,#888888), color-stop(3%,#888888), color-stop(91%,#3a3c42)); /* Chrome,Safari4+ */
	background: -webkit-linear-gradient(left,  #888888 0%,#888888 3%,#3a3c42 91%); /* Chrome10+,Safari5.1+ */
	background: -o-linear-gradient(left,  #888888 0%,#888888 3%,#3a3c42 91%); /* Opera 11.10+ */
	background: -ms-linear-gradient(left,  #888888 0%,#888888 3%,#3a3c42 91%); /* IE10+ */
	background: linear-gradient(to right,  #888888 0%,#888888 3%,#3a3c42 91%); /* W3C */
	filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#888888', endColorstr='#3a3c42',GradientType=1 ); /* IE6-9 */
}

.keyboard-char {
	background: #999999;
	box-shadow: 2px 2px 3px #777777;
	cursor: pointer;
	cursor: hand;
	font-size: 80%;
	color: white;
	border-radius: 2px;
	padding-right: 3px;
	margin-right: 3px;
	padding-left: 3px;
	margin-top: 0;
}

.example-button {
	/* the button used to expand/collapse example code sections */
	background: #bb2200;
	box-shadow: 2px 2px 3px #777777;
	cursor: pointer;
	cursor: hand;
	font-size: 80%;
	color: white;
	border-radius: 3px;
	padding-right: 5px;
	margin-top: 0;
	padding-left: 5px;
	float: right;
}

</style>


{% raw %}

<!-- Handlebars templates and helper functions ------------------- -->

<script id="method-doc" type="text/x-handlebars-template">
	{{#if LONGDESC}}
		<a name="{{METHOD}}"> </a>
		<details>
			<summary>
			<span style="font-weight:900">
				{{METHOD}}
			</span> 
			<span class='short-desc'> &mdash; 
			{{{SHORTDESC}}}
			</span>
			</summary>
			<div style="margin-left:40px;">
				{{{LONGDESC}}}
				{{{codeLink METHOD FILE}}}
				{{{showExamples EXAMPLE}}}
			</div>
		</details>
	{{else}}
		<a name="{{METHOD}}"> </a>
		<span style="padding-left:19px; font-weight:900">
				{{#if ALIASOF}}
					&nbsp;&nbsp;
				{{/if}}
			{{METHOD}}
		</span> &mdash;
			{{{SHORTDESC}}}
	{{/if}}
</script>



<script id="method-example" type="text/x-handlebars-template">
	<summary>{{{DESCRIPTION}}}</summary>
	<div class="highlight">
	<pre style="margin-left:20px; margin-bottom:0; padding:0; padding-left:10px;">
		<code class="language-javascript" data-lang="javascript">
{{CODE}}</code>
	</pre>
	</div>
{{#if OUTPUT}}
	<div class="example-output">output:</div>
	<div class="highlight">
	<pre style="margin-left:20px; padding:0; padding-top:12px; padding-left:10px;">
{{OUTPUT}}
	</pre>
	</div>
{{/if}}
</script>



<script id="method-example-single" type="text/x-handlebars-template">
	<div class="highlight">
	<pre style="margin-left:20px; margin-bottom:0; padding:0; padding-left:10px;">
		<code class="language-javascript" data-lang="javascript">
{{CODE}}</code>
	</pre>
	</div>
{{#if OUTPUT}}
	<div class="example-output">output:</div>
	<div class="highlight">
	<pre style="margin-left:20px; padding:0; padding-top:12px; padding-left:10px;">
{{OUTPUT}}
	</pre>
	</div>
{{/if}}
</script>



<script>
//
// Handlebars helper functions
//


Handlebars.registerHelper('codeLink', function (method, file) {
	if (typeof method === 'undefined') { return '' }
	if (typeof file   === 'undefined') { return '' }

	var output = '<details ontoggle="displaySourceBox(';
	output += '\'' + method + '\', \'' + file + '\');"';
	output += '><summary>';
	output += 'View method source code ';
	output += '(<a href=https://sourcegraph.com/github.com/craigsapp/';
	output += 'RationalNumber@master/.CommonJSPackage/rational-number/.def/';

	if (file === 'RationalNumber-base.js') {
		output += 'commonjs/lib/RationalNumber-base.js/-/prototype/';
	} else if (file === 'RationalNumber-math.js') {
		output += 'commonjs/index.js/-/prototype/';
	} else {
		return '';
	}
	output += method;
	output += '>on Sourcegraph</a>)';
	output += '</summary>';

	output += '<div id="' + method + '_sourcebox">';
	output += '</div>';

	output += '</details>\n';
	return output;
});


function displaySourceBox (method, file) {

	var target = document.querySelector("div#" + method + '_sourcebox');
	if (!target) {
		return;
	}

	var sourcebox = '';
	sourcebox += 'https://sourcegraph.com/github.com/craigsapp';
	sourcebox += '/RationalNumber/.CommonJSPackage/rational-number/.def/commonjs/';
	if (file === 'RationalNumber-base.js') {
		sourcebox += 'lib/RationalNumber-base.js/-/prototype/';
	} else if (file === 'RationalNumber-math.js') {
		sourcebox += 'index.js/-/prototype/';
	} else {
		return '';
	}
	sourcebox += method;
	sourcebox += '/.sourcebox.js';

	var testing = '<script src=' + sourcebox + '>';
   testing += "</scr'; testing += 'ipt> xxx";
	target.innerHTML = testing;

}



Handlebars.registerHelper('showExamples', function (entry) {
	if (typeof entry === 'undefined') {
		return 'empty';
	}

	var source = document.getElementById('method-example').textContent;
	var template = Handlebars.compile(source);
	var sourcesingle = document.getElementById('method-example-single')
								.textContent;
	var templatesingle = Handlebars.compile(sourcesingle);

	var output = '';
	if (entry instanceof Array) {
		output += '<span style="font-weight:700">Examples</span>';
		output += '<span';
		output += ' class="example-button"';
		output += ' onclick="expandAllExamples(this);">'
		output += 'Expand all';
		output += '</span>\n';
		output += '<ol style="padding-left:0; margin-left:0;">\n';
		for (var i=0; i<entry.length; i++) {
			output += '<li>\n';
			output += '<details class="example-details">\n';
			output += template(entry[i]);
			output += '</details>\n';
			output += '</li>\n';
		}
		output += '</ol>\n';
	} else {
	   output = '<details class="example-details">';
		output += '<summary>';
		output += '<span style="font-weight:700">Example:</span> ';
		output += entry.DESCRIPTION;
		output += '</summary>';
		output += templatesingle(entry);
	   output += '</details>';
		output += '<br>';
	}

	return output;
});




</script>

<script>

document.body.addEventListener('click', function (event) {
	// needs some fixing so that clicking in documentation section
	// does not show the short description.
	var target = event.target;
	if (target && target.className.match(/example-button/)) {
		return;
	}

	while (target) {
		var parent = target.parentNode;
   	if (target.nodeName === 'DETAILS') {
			if (parent && parent.nodeName === 'DIV' &&
					parent.className.match(/docslot/)) {
				showOrHideShortDescription(target);
			} else {
				return;
			}
		}
		target = parent;
	}
});



function showOrHideShortDescription(target) {
   // check the first child which should be <details>.
   // if it is open, then set a hidden style on <details>/<summary>
	// first child with "short-desc" as the class.  If <details>
	// is not open, then unhide the same sub-element.
	if (target.nodeName !== 'DETAILS') {
		return;
	}

	// go to the first subelement which has a class of "short-desc":
	var shortdesc = target.querySelector('.short-desc');
	if (!shortdesc) {
		return;
	}
	if (shortdesc.nodeName !== 'SPAN') {
		return;
	}
	var openstate = target.getAttribute('open');
	if (typeof openstate !== 'string') {
		// hide the short-desc text with visibility:hidden
		shortdesc.style.visibility = 'hidden';
	} else {
		// show the short-desc text with visibility:visible
		shortdesc.style.visibility = 'visible';
	}
}



function hideShortDescription(target) {
   // check the first child which should be <details>.
   // if it is open, then set a hidden style on <details>/<summary>
	// first child with "short-desc" as the class.  If <details>
	// is not open, then unhide the same sub-element.
	if (target.nodeName !== 'DETAILS') {
		return;
	}
	// go to the first subelement which has a class of "short-desc":
	var shortdesc = target.querySelector('.short-desc');
	if (!shortdesc) {
		return;
	}
	if (shortdesc.nodeName !== 'SPAN') {
		return;
	}
	var openstate = target.getAttribute('open');
	shortdesc.style.visibility = 'hidden';
}

function showShortDescription(target) {
   // check the first child which should be <details>.
   // if it is open, then set a hidden style on <details>/<summary>
	// first child with "short-desc" as the class.  If <details>
	// is not open, then unhide the same sub-element.
	if (target.nodeName !== 'DETAILS') {
		return;
	}
	// go to the first subelement which has a class of "short-desc":
	var shortdesc = target.querySelector('.short-desc');
	if (!shortdesc) {
		return;
	}
	if (shortdesc.nodeName !== 'SPAN') {
		return;
	}
	var openstate = target.getAttribute('open');
	shortdesc.style.visibility = 'visible';
}



function insertDocumentation(target, template) {
	var name    = target.id;
	var file    = '/doc/methods/' + name + '.aton';
	var request = new XMLHttpRequest();
	request.open('GET', file);
	request.addEventListener('load', function () {
		var atondata = this.responseText;
		var aton = new ATON;
		aton.setOnlyChildRoot();
		var docobj = aton.parse(atondata);
		var dochtml = template(docobj);
		target.innerHTML = dochtml;
	});
	request.addEventListener('error', function () {
		console.error(this.statusText);
	});
	request.send();
};


function expandAllExamples(element) {
	text = element.innerHTML;
	var detailslist = element.parentNode.querySelectorAll('li > details');
	var i;
	if (text.match(/Collapse all/)) {
		for(i=0; i<detailslist.length; i++) {
			detailslist[i].removeAttribute('open');
		}
		element.textContent = 'Expand all';
	} else {
		// expand all examples
		for(i=0; i<detailslist.length; i++) {
			detailslist[i].setAttribute('open', true);
		}
		element.textContent = 'Collapse all';
	}
}


function openAllDocumentation() {
	var methodslots = document.querySelectorAll('.docslot');
	var i;
	for (i=0; i<methodslots.length; i++) {
		var details = methodslots[i].querySelector('details');
		if (details) {
			details.setAttribute('open', true);
			hideShortDescription(details);
		}
	}
}


function closeAllDocumentation() {
	var methodslots = document.querySelectorAll('.docslot');
	var i;
	for (i=0; i<methodslots.length; i++) {
		var details = methodslots[i].querySelector('details');
		if (details) {
			details.removeAttribute('open');
			showShortDescription(details);
		}
	}
}



function hideAllExamples() {
	var examples = document.querySelectorAll("details.example-details");
	for (var i=0; i<examples.length; i++) {
		examples[i].removeAttribute('open');
	}
}



function showAllExamples() {
	var examples = document.querySelectorAll("details.example-details");
	for (var i=0; i<examples.length; i++) {
		examples[i].setAttribute('open', true);
	}
}

</script>
{% endraw %}

